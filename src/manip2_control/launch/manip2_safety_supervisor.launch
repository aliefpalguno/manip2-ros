
<launch>
  <!-- Safety Supervisor for 5-DOF Arm -->
  <node pkg="manip2_control" type="manip2_safety_supervisor.py" name="manip2_safety_supervisor" output="screen">
    <!-- Topics (match your system) -->
    <param name="topic_joint_states" value="/joint_states"/>
    <param name="topic_telem_si" value="/manip2/telemetry_si"/>
    <param name="topic_telem_raw" value="/manip2/telemetry_raw"/>
    <param name="topic_errors" value="/manip2/error_status"/>
    <param name="takeover_cmd_topic" value="/manip2/command_deg"/>

    <!-- Publish safety events (web bridge can mirror these to MQTT) -->
    <param name="topic_event" value="/manip2/safety/event"/>
    <param name="topic_state" value="/manip2/safety/state"/>
    <param name="topic_diag"  value="/manip2/safety/diagnostics"/>

    <!-- Placeholder limits (tune later) -->
    <rosparam param="deg_limits">[[-90,90],[-10,45],[-106,0],[-77,113],[-103,103]]</rosparam>
    <param name="warn_margin_deg" value="5.0"/>
    <param name="joint_exceed_hold_s" value="0.5"/>

    <!-- Temps / Voltage / Load thresholds (placeholders; set your own values) -->
    <param name="p1_temp_warn_c" value=""/>  <!-- e.g., 65 -->
    <param name="p1_temp_crit_c" value=""/>  <!-- e.g., 75 -->
    <param name="p2_temp_warn_c" value=""/>
    <param name="p2_temp_crit_c" value=""/>

    <!-- Protocol 1 voltage limits -->
    <param name="p1_volt_warn_low_v"  value=""/>   <!-- ex: 11.5 -->
    <param name="p1_volt_crit_low_v"  value=""/>   <!-- ex: 11.0 -->
    <param name="p1_volt_warn_high_v" value=""/>   <!-- ex: 14.5 -->
    <param name="p1_volt_crit_high_v" value=""/>   <!-- ex: 15.0 -->

    <!-- Protocol 2 voltage limits -->
    <param name="p2_volt_warn_low_v"  value=""/>   <!-- ex: 23.0 -->
    <param name="p2_volt_crit_low_v"  value=""/>   <!-- ex: 22.0 -->
    <param name="p2_volt_warn_high_v" value=""/>   <!-- ex: 27.0 -->
    <param name="p2_volt_crit_high_v" value=""/>   <!-- ex: 28.0 -->

    <param name="p1_load_warn_pct" value=""/>
    <param name="p1_load_crit_pct" value=""/>

    <param name="p2_current_warn_a" value="0.8"/>
    <param name="p2_current_crit_a" value="1.4"/>
    <param name="p2_load_cont_warn_pct" value=""/>
    <param name="p2_load_cont_crit_pct" value=""/>

    <param name="drop_spike_samples" value="true" />
    <param name="max_joint_step_deg" value="15.0" />
    <param name="skip_joint_when_comm_bad" value="true" />
    <rosparam param="joint_warn_margin_per_joint">[5,1.0,0.5,5,5]</rosparam>
    <param name="allow_at_limit" value="false" />
    <param name="lockout_delay_s" value="0.25" />
    <param name="comm_error_crit_s" value="0.5" />

    <param name="loop_rate_hz" value="50.0" />

    <!-- Safe pose & takeover services -->
    <rosparam param="stage2_services">["/manip2/go_initial_and_shutdown", "/manip2/emergency_shutdown"]</rosparam>
    <param name="service_timeout_s" value="0.1"/>
  </node>
</launch>
